<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create, Manage, and Search DWS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 1000px;
        }

        h1 {
            text-align: center;
        }

        input, select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .hidden {
            display: none;
        }

        .table-container {
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .export-btns {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Create DWS Section -->
        <div id="createDWSSection">
            <h1>Create DWS</h1>
            <form id="createDWSForm">
                <input type="text" id="dwsNo" placeholder="DWS No." required>
                <input type="date" id="date" placeholder="Date" required>
                <input type="text" id="structureName" placeholder="Structure Name" required>
                <input type="text" id="siNo" placeholder="SI No." required>
                <input type="text" id="workDescription" placeholder="Work Description" required>
                <input type="text" id="location" placeholder="Location" required>
                <!-- Manpower Section -->
                <h3>Manpower</h3>
                <div id="manpowerSection">
                    <div class="manpower-entry">
                        <input type="text" class="badgeNo" placeholder="Badge No.">
                        <input type="text" class="manpowerName" placeholder="Name">
                        <input type="number" class="normalHours" placeholder="Normal Hours">
                        <input type="number" class="otHours" placeholder="OT Hours">
                        <input type="number" class="holiday" placeholder="Holiday Hours">
                    </div>
                </div>
                <button type="button" id="addManpowerBtn">Add Manpower</button>
                <!-- Equipment Section -->
                <h3>Equipment</h3>
                <div id="equipmentSection">
                    <div class="equipment-entry">
                        <input type="text" class="equipmentName" placeholder="Equipment Name">
                        <input type="number" class="workingHours" placeholder="Working Hours">
                    </div>
                </div>
                <button type="button" id="addEquipmentBtn">Add Equipment</button>
                <!-- Consumables Section -->
                <h3>Consumables / Materials</h3>
                <div id="consumablesSection">
                    <div class="consumables-entry">
                        <input type="text" class="consumableName" placeholder="Consumables Name">
                        <input type="number" class="quantity" placeholder="Quantity">
                    </div>
                </div>
                <button type="button" id="addConsumableBtn">Add Consumable</button>
                <button type="submit" id="saveDWSBtn">Save DWS</button>
            </form>
        </div>

        <!-- Manage DWS Section -->
        <div id="manageDWSSection" class="hidden">
            <h1>Manage DWS</h1>
            <div class="table-container">
                <table id="dwsTable">
                    <thead>
                        <tr>
                            <th>DWS No.</th>
                            <th>Date</th>
                            <th>Structure Name</th>
                            <th>SI No.</th>
                            <th>Work Description</th>
                            <th>Location</th>
                            <th>Manpower</th>
                            <th>Equipment</th>
                            <th>Consumables</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dwsTableBody">
                    </tbody>
                </table>
            </div>
            <div class="export-btns">
                <button id="exportToExcelBtn">Export to Excel</button>
                <button id="exportToPDFBtn">Export to PDF</button>
            </div>
        </div>

        <!-- Search DWS Section -->
        <div id="searchDWSSection" class="hidden">
            <h1>Search DWS</h1>
            <input type="text" id="searchDWSNo" placeholder="Enter DWS No.">
            <button type="button" id="searchDWSBtn">Search</button>
            <div id="searchResult"></div>
        </div>
    </div>

    <script>
        let dwsData = JSON.parse(localStorage.getItem('dwsData')) || [];
        let currentDWSNo = dwsData.length + 1;

        document.getElementById('addManpowerBtn').addEventListener('click', () => {
            const manpowerEntry = document.createElement('div');
            manpowerEntry.classList.add('manpower-entry');
            manpowerEntry.innerHTML = `
                <input type="text" class="badgeNo" placeholder="Badge No.">
                <input type="text" class="manpowerName" placeholder="Name">
                <input type="number" class="normalHours" placeholder="Normal Hours">
                <input type="number" class="otHours" placeholder="OT Hours">
                <input type="number" class="holiday" placeholder="Holiday Hours">
            `;
            document.getElementById('manpowerSection').appendChild(manpowerEntry);
        });

        document.getElementById('addEquipmentBtn').addEventListener('click', () => {
            const equipmentEntry = document.createElement('div');
            equipmentEntry.classList.add('equipment-entry');
            equipmentEntry.innerHTML = `
                <input type="text" class="equipmentName" placeholder="Equipment Name">
                <input type="number" class="workingHours" placeholder="Working Hours">
            `;
            document.getElementById('equipmentSection').appendChild(equipmentEntry);
        });

        document.getElementById('addConsumableBtn').addEventListener('click', () => {
            const consumableEntry = document.createElement('div');
            consumableEntry.classList.add('consumables-entry');
            consumableEntry.innerHTML = `
                <input type="text" class="consumableName" placeholder="Consumable Name">
                <input type="number" class="quantity" placeholder="Quantity">
            `;
            document.getElementById('consumablesSection').appendChild(consumableEntry);
        });

        document.getElementById('createDWSForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const dws = {
                dwsNo: currentDWSNo,
                date: document.getElementById('date').value,
                structureName: document.getElementById('structureName').value,
                siNo: document.getElementById('siNo').value,
                workDescription: document.getElementById('workDescription').value,
                location: document.getElementById('location').value,
                manpower: getManpowerData(),
                equipment: getEquipmentData(),
                consumables: getConsumablesData(),
            };

            dwsData.push(dws);
            localStorage.setItem('dwsData', JSON.stringify(dwsData));
            currentDWSNo++;

            alert('DWS saved successfully!');
            switchSection('manageDWSSection');
            loadDWSData();
        });

        function getManpowerData() {
            const manpowerEntries = document.querySelectorAll('.manpower-entry');
            const manpowerData = [];
            manpowerEntries.forEach(entry => {
                manpowerData.push({
                    badgeNo: entry.querySelector('.badgeNo').value,
                    name: entry.querySelector('.manpowerName').value,
                    normalHours: entry.querySelector('.normalHours').value,
                    otHours: entry.querySelector('.otHours').value,
                    holiday: entry.querySelector('.holiday').value,
                });
            });
            return manpowerData;
        }

        function getEquipmentData() {
            const equipmentEntries = document.querySelectorAll('.equipment-entry');
            const equipmentData = [];
            equipmentEntries.forEach(entry => {
                equipmentData.push({
                    equipmentName: entry.querySelector('.equipmentName').value,
                    workingHours: entry.querySelector('.workingHours').value,
                });
            });
            return equipmentData;
        }

        function getConsumablesData() {
            const consumablesEntries = document.querySelectorAll('.consumables-entry');
            const consumablesData = [];
            consumablesEntries.forEach(entry => {
                consumablesData.push({
                    consumableName: entry.querySelector('.consumableName').value,
                    quantity: entry.querySelector('.quantity').value,
                });
            });
            return consumablesData;
        }

        function switchSection(sectionId) {
            document.querySelectorAll('.container > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
        }

        function loadDWSData() {
            const tbody = document.getElementById('dwsTableBody');
            tbody.innerHTML = '';
            dwsData.forEach(dws => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dws.dwsNo}</td>
                                        <td>${dws.date}</td>
                    <td>${dws.structureName}</td>
                    <td>${dws.siNo}</td>
                    <td>${dws.workDescription}</td>
                    <td>${dws.location}</td>
                    <td>
                        ${dws.manpower.map(man => `
                            <div>${man.name} (${man.badgeNo}): Normal Hours: ${man.normalHours}, OT Hours: ${man.otHours}, Holiday: ${man.holiday}</div>
                        `).join('')}
                    </td>
                    <td>
                        ${dws.equipment.map(eq => `
                            <div>${eq.equipmentName}: ${eq.workingHours} hours</div>
                        `).join('')}
                    </td>
                    <td>
                        ${dws.consumables.map(cons => `
                            <div>${cons.consumableName}: ${cons.quantity}</div>
                        `).join('')}
                    </td>
                    <td>
                        <button class="editBtn" onclick="editDWS(${dws.dwsNo})">Edit</button>
                        <button class="deleteBtn" onclick="deleteDWS(${dws.dwsNo})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function editDWS(dwsNo) {
            const dws = dwsData.find(item => item.dwsNo === dwsNo);
            // Populate the form for editing with the existing data
            document.getElementById('dwsNo').value = dws.dwsNo;
            document.getElementById('date').value = dws.date;
            document.getElementById('structureName').value = dws.structureName;
            document.getElementById('siNo').value = dws.siNo;
            document.getElementById('workDescription').value = dws.workDescription;
            document.getElementById('location').value = dws.location;
            // Add code to populate manpower, equipment, and consumables sections
            switchSection('createDWSSection');
        }

        function deleteDWS(dwsNo) {
            if (confirm('Are you sure you want to delete this DWS?')) {
                dwsData = dwsData.filter(item => item.dwsNo !== dwsNo);
                localStorage.setItem('dwsData', JSON.stringify(dwsData));
                loadDWSData();
            }
        }

        document.getElementById('searchDWSBtn').addEventListener('click', () => {
            const searchNo = document.getElementById('searchDWSNo').value;
            const result = dwsData.find(dws => dws.dwsNo == searchNo);
            const searchResultDiv = document.getElementById('searchResult');
            if (result) {
                searchResultDiv.innerHTML = `
                    <h3>Search Results</h3>
                    <p>DWS No: ${result.dwsNo}</p>
                    <p>Date: ${result.date}</p>
                    <p>Structure Name: ${result.structureName}</p>
                    <p>SI No: ${result.siNo}</p>
                    <p>Work Description: ${result.workDescription}</p>
                    <p>Location: ${result.location}</p>
                `;
            } else {
                searchResultDiv.innerHTML = '<p>No results found.</p>';
            }
        });

        document.getElementById('exportToExcelBtn').addEventListener('click', () => {
            // Export data to Excel
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(dwsData);
            XLSX.utils.book_append_sheet(wb, ws, 'DWS Data');
            XLSX.writeFile(wb, 'DWS_Data.xlsx');
        });

        document.getElementById('exportToPDFBtn').addEventListener('click', () => {
            // Export data to PDF
            const doc = new jsPDF();
            doc.autoTable({
                head: [['DWS No.', 'Date', 'Structure Name', 'SI No.', 'Work Description', 'Location']],
                body: dwsData.map(dws => [
                    dws.dwsNo, dws.date, dws.structureName, dws.siNo, dws.workDescription, dws.location
                ]),
            });
            doc.save('DWS_Data.pdf');
        });

        // Load the data on page load
        if (dwsData.length > 0) {
            switchSection('manageDWSSection');
            loadDWSData();
        } else {
            switchSection('createDWSSection');
        }
    </script>

    <!-- Include external libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.autotable.min.js"></script>

</body>
</html>
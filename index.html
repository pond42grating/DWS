<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DWS Management</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    button {
      padding: 10px 15px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background-color: #45a049;
    }
    .back-button {
      margin-top: 20px;
      padding: 10px 15px;
      background-color: #f44336;
      color: white;
      border: none;
      cursor: pointer;
    }
    .back-button:hover {
      background-color: #da190b;
    }
    .error {
      color: red;
      font-size: 0.9em;
    }
    .preview-section {
      margin-top: 20px;
    }
    #manageDWSContainer {
      display: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>DWS Management</h1>

  <button id="createDWSBtn">Create DWS</button>
  <button id="manageDWSBtn">Manage DWS</button>

  <div id="createDWSForm" style="display: none;">
    <h1>Create DWS</h1>
  
    <div class="form-section">
      <label for="dwsNo">DWS No.</label>
      <input type="text" id="dwsNo" readonly>
    </div>

    <div class="form-section">
      <label for="structureName">Structure Name</label>
      <input type="text" id="structureName">
      <div class="error" id="structureNameError"></div>
    </div>

    <div class="form-section">
      <label for="siNo">SI No.</label>
      <input type="text" id="siNo">
      <div class="error" id="siNoError"></div>
    </div>

    <div class="form-section">
      <label for="workDescription">Work Description</label>
      <input type="text" id="workDescription">
      <div class="error" id="workDescriptionError"></div>
    </div>

    <div class="form-section">
      <label for="location">Location</label>
      <input type="text" id="location">
      <div class="error" id="locationError"></div>
    </div>

    <!-- Manpower Section -->
    <div class="form-section">
      <h3>Manpower</h3>
      <label for="badgeNo">Badge No.</label>
      <input type="text" id="badgeNo">
      <div class="error" id="badgeNoError"></div>

      <label for="manpowerName">Name</label>
      <input type="text" id="manpowerName">
      <div class="error" id="manpowerNameError"></div>

      <label for="normalHour">Normal Hour</label>
      <input type="number" id="normalHour">
      <div class="error" id="normalHourError"></div>

      <label for="otHour">OT Hour</label>
      <input type="number" id="otHour">
      <div class="error" id="otHourError"></div>

      <label for="holiday">Holiday</label>
      <input type="text" id="holiday">
      <div class="error" id="holidayError"></div>

      <button type="button" onclick="addManpower()">Add Manpower</button>

      <div class="preview-section" id="manpowerPreview">
        <h4>Manpower Preview:</h4>
        <table id="manpowerTable">
          <tr>
            <th>Badge No.</th>
            <th>Name</th>
            <th>Normal Hour</th>
            <th>OT Hour</th>
            <th>Holiday</th>
          </tr>
        </table>
      </div>
    </div>

    <!-- Equipment Section -->
    <div class="form-section">
      <h3>Equipment</h3>
      <label for="equipmentName">Equipment Name</label>
      <input type="text" id="equipmentName">
      <div class="error" id="equipmentNameError"></div>

      <label for="workingHours">Working Hours</label>
      <input type="number" id="workingHours">
      <div class="error" id="workingHoursError"></div>

      <button type="button" onclick="addEquipment()">Add Equipment</button>

      <div class="preview-section" id="equipmentPreview">
        <h4>Equipment Preview:</h4>
        <table id="equipmentTable">
          <tr>
            <th>Equipment Name</th>
            <th>Working Hours</th>
          </tr>
        </table>
      </div>
    </div>

    <!-- Consumables Section -->
    <div class="form-section">
      <h3>Consumables</h3>
      <label for="consumableName">Consumable Name</label>
      <input type="text" id="consumableName">
      <div class="error" id="consumableNameError"></div>

      <label for="quantity">Quantity (Nos/ML)</label>
      <input type="number" id="quantity">
      <div class="error" id="quantityError"></div>

      <button type="button" onclick="addConsumable()">Add Consumable</button>

      <div class="preview-section" id="consumablePreview">
        <h4>Consumable Preview:</h4>
        <table id="consumableTable">
          <tr>
            <th>Consumable Name</th>
            <th>Quantity</th>
          </tr>
        </table>
      </div>
    </div>

    <button id="saveButton" onclick="saveData()">Save DWS</button>
    <button class="back-button" onclick="goBack()">Back to Home</button>
  </div>

  <div id="manageDWSContainer">
    <h1>Manage DWS</h1>
    <table id="savedDWSList">
      <tr>
        <th>DWS No.</th>
        <th>Structure Name</th>
        <th>SI No.</th>
        <th>Work Description</th>
        <th>Location</th>
      </tr>
    </table>
    <button class="back-button" onclick="goBackManage()">Back to Home</button>
  </div>

  <script>
    let dwsCounter = 1;

    document.getElementById('createDWSBtn').onclick = function() {
      document.getElementById('createDWSForm').style.display = 'block';
      document.getElementById('manageDWSContainer').style.display = 'none';
      document.getElementById('dwsNo').value = `DWS-${dwsCounter}`;
    };

    document.getElementById('manageDWSBtn').onclick = function() {
      document.getElementById('manageDWSContainer').style.display = 'block';
      document.getElementById('createDWSForm').style.display = 'none';
      loadSavedDWS();
    };

    function showError(elementId, errorMessage) {
      document.getElementById(elementId).innerText = errorMessage;
    }

    function clearError(elementId) {
      document.getElementById(elementId).innerText = '';
    }

    function validateInputs(inputs) {
      let isValid = true;
      inputs.forEach(({ id, errorId, message }) => {
        if (!document.getElementById(id).value) {
          showError(errorId, message);
          isValid = false;
        } else {
          clearError(errorId);
        }
      });
      return isValid;
    }

    function addManpower() {
      const inputs = [
        { id: 'badgeNo', errorId: 'badgeNoError', message: 'Badge No. is required' },
        { id: 'manpowerName', errorId: 'manpowerNameError', message: 'Name is required' },
        { id: 'normalHour', errorId: 'normalHourError', message: 'Normal Hour is required' },
        { id: 'otHour', errorId: 'otHourError', message: 'OT Hour is required' },
        { id: 'holiday', errorId: 'holidayError', message: 'Holiday is required' }
      ];

      if (validateInputs(inputs)) {
        const table = document.getElementById('manpowerTable');
        const row = table.insertRow();
        row.innerHTML = `<td>${document.getElementById('badgeNo').value}</td>
                         <td>${document.getElementById('manpowerName').value}</td>
                         <td>${document.getElementById('normalHour').value}</td>
                         <td>${document.getElementById('otHour').value}</td>
                         <td>${document.getElementById('holiday').value}</td>`;

        inputs.forEach(({ id }) => document.getElementById(id).value = '');
      }
    }

    function addEquipment() {
      const inputs = [
        { id: 'equipmentName', errorId: 'equipmentNameError', message: 'Equipment Name is required' },
        { id: 'workingHours', errorId: 'workingHoursError', message: 'Working Hours are required' }
      ];

      if (validateInputs(inputs)) {
        const table = document.getElementById('equipmentTable');
        const row = table.insertRow();
        row.innerHTML = `<td>${document.getElementById('equipmentName').value}</td>
                         <td>${document.getElementById('workingHours').value}</td>`;

        inputs.forEach(({ id }) => document.getElementById(id).value = '');
      }
    }

    function addConsumable() {
      const inputs = [
        { id: 'consumableName', errorId: 'consumableNameError', message: 'Consumable Name is required' },
        { id: 'quantity', errorId: 'quantityError', message: 'Quantity is required' }
      ];

      if (validateInputs(inputs)) {
        const table = document.getElementById('consumableTable');
        const row = table.insertRow();
        row.innerHTML = `<td>${document.getElementById('consumableName').value}</td>
                         <td>${document.getElementById('quantity').value}</td>`;

        inputs.forEach(({ id }) => document.getElementById(id).value = '');
      }
    }

    function saveData() {
      const inputs = [
        { id: 'structureName', errorId: 'structureNameError', message: 'Structure Name is required' },
        { id: 'siNo', errorId: 'siNoError', message: 'SI No. is required' },
        { id: 'workDescription', errorId: 'workDescriptionError', message: 'Work Description is required' },
        { id: 'location', errorId: 'locationError', message: 'Location is required' }
      ];

      if (validateInputs(inputs)) {
        const dwsData = {
          dwsNo: `DWS-${dwsCounter++}`,
          structureName: document.getElementById('structureName').value,
          siNo: document.getElementById('siNo').value,
          workDescription: document.getElementById('workDescription').value,
          location: document.getElementById('location').value,
          manpower: getTableData('manpowerTable'),
          equipment: getTableData('equipmentTable'),
          consumables: getTableData('consumableTable')
        };

        let savedData = JSON.parse(localStorage.getItem('dwsData')) || [];
        savedData.push(dwsData);
        localStorage.setItem('dwsData', JSON.stringify(savedData));

        alert('DWS saved successfully!');
        clearAllFields();
      }
    }

    function getTableData(tableId) {
      const table = document.getElementById(tableId);
      let data = [];
      for (let i = 1; i < table.rows.length; i++) { // Skip header row
        let row = table.rows[i];
        let rowData = {};
        for (let j = 0; j < row.cells.length; j++) {
          rowData[table.rows[0].cells[j].innerText] = row.cells[j].innerText;
        }
        data.push(rowData);
      }
      return data;
    }

    function clearAllFields() {
      document.getElementById('structureName').value = '';
      document.getElementById('siNo').value = '';
      document.getElementById('workDescription').value = '';
      document.getElementById('location').value = '';
      document.getElementById('manpowerTable').innerHTML = `<tr>
        <th>Badge No.</th>
        <th>Name</th>
        <th>Normal Hour</th>
        <th>OT Hour</th>
        <th>Holiday</th>
      </tr>`;
      document.getElementById('equipmentTable').innerHTML = `<tr>
        <th>Equipment Name</th>
        <th>Working Hours</th>
      </tr>`;
      document.getElementById('consumableTable').innerHTML = `<tr>
        <th>Consumable Name</th>
        <th>Quantity</th>
      </tr>`;
    }

    function loadSavedDWS() {
      const savedData = JSON.parse(localStorage.getItem('dwsData')) || [];
      const table = document.getElementById('savedDWSList');
      // Clear existing rows except for the header
      while (table.rows.length > 1) {
        table.deleteRow(1);
      }
      savedData.forEach(dws => {
        const row = table.insertRow();
        row.innerHTML = `<td>${dws.dwsNo}</td>
                         <td>${dws.structureName}</td>
                         <td>${dws.siNo}</td>
                         <td>${dws.workDescription}</td>
                         <td>${dws.location}</td>`;
      });
    }

    function goBack() {
      document.getElementById('createDWSForm').style.display = 'none';
    }

    function goBackManage() {
      document.getElementById('manageDWSContainer').style.display = 'none';
    }
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User and Admin Control</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    .input-section, .auth-section, .details-section {
      margin-bottom: 15px;
    }
    .hidden {
      display: none;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>

  <h1>User Registration and Admin Control</h1>

  <!-- Authentication Section (Sign-In and Sign-Up) -->
  <div id="authSection">
    <div class="auth-section">
      <h2>Sign Up</h2>
      <label for="signupUsername">Username:</label>
      <input type="text" id="signupUsername" placeholder="Enter Username" required><br><br>

      <label for="signupPassword">Password:</label>
      <input type="password" id="signupPassword" placeholder="Enter Password" required><br><br>

      <button id="signupBtn">Sign Up</button>
      <p class="error" id="signupError"></p>
    </div>

    <div class="auth-section">
      <h2>Sign In</h2>
      <label for="signinUsername">Username:</label>
      <input type="text" id="signinUsername" placeholder="Enter Username" required><br><br>

      <label for="signinPassword">Password:</label>
      <input type="password" id="signinPassword" placeholder="Enter Password" required><br><br>

      <button id="signinBtn">Sign In</button>
      <p class="error" id="signinError"></p>
    </div>
  </div>

  <!-- Admin Login Section -->
  <div id="adminSection" class="hidden">
    <h2>Admin Login</h2>
    <label for="adminUsername">Admin Username:</label>
    <input type="text" id="adminUsername" placeholder="Enter Admin Username" required><br><br>

    <label for="adminPassword">Admin Password:</label>
    <input type="password" id="adminPassword" placeholder="Enter Admin Password" required><br><br>

    <button id="adminLoginBtn">Login as Admin</button>
    <p class="error" id="adminError"></p>
  </div>

  <!-- Admin Dashboard (After Admin Login) -->
  <div id="adminDashboard" class="hidden">
    <h2>Admin Dashboard</h2>
    <h3>Sign-Up Requests</h3>
    <ul id="signupRequestsList"></ul>
  </div>

  <!-- Main App (Visible After User Sign-In) -->
  <div id="mainApp" class="hidden">
    <h1>Welcome to the Project Data Management App</h1>
    <button id="logoutBtn">Logout</button>
    <div id="projectSection">
      <h2>Enter Project Information</h2>
      <!-- Your project input fields go here -->
    </div>
  </div>

  <script>
    let users = JSON.parse(localStorage.getItem("users")) || [];
    let adminLoggedIn = false;
    let currentUser = null;

    const signupBtn = document.getElementById("signupBtn");
    const signinBtn = document.getElementById("signinBtn");
    const adminLoginBtn = document.getElementById("adminLoginBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    const signupUsername = document.getElementById("signupUsername");
    const signupPassword = document.getElementById("signupPassword");
    const signinUsername = document.getElementById("signinUsername");
    const signinPassword = document.getElementById("signinPassword");
    const adminUsername = document.getElementById("adminUsername");
    const adminPassword = document.getElementById("adminPassword");

    const signupError = document.getElementById("signupError");
    const signinError = document.getElementById("signinError");
    const adminError = document.getElementById("adminError");

    const authSection = document.getElementById("authSection");
    const adminSection = document.getElementById("adminSection");
    const adminDashboard = document.getElementById("adminDashboard");
    const mainApp = document.getElementById("mainApp");
    const signupRequestsList = document.getElementById("signupRequestsList");

    // Check if the user is an admin or a registered user
    const checkAdminAccess = () => {
      if (adminLoggedIn) {
        authSection.classList.add("hidden");
        adminSection.classList.add("hidden");
        adminDashboard.classList.remove("hidden");
        displaySignupRequests();
      } else {
        adminSection.classList.remove("hidden");
      }
    };

    // Display signup requests in the admin dashboard
    const displaySignupRequests = () => {
      signupRequestsList.innerHTML = '';
      users.forEach((user, index) => {
        if (!user.isApproved) {
          const listItem = document.createElement("li");
          listItem.textContent = `Username: ${user.username}`;
          listItem.innerHTML += ` <button onclick="approveSignup(${index})">Approve</button>`;
          listItem.innerHTML += ` <button onclick="rejectSignup(${index})">Reject</button>`;
          signupRequestsList.appendChild(listItem);
        }
      });
    };

    // Approve a user signup
    const approveSignup = (index) => {
      users[index].isApproved = true;
      localStorage.setItem("users", JSON.stringify(users));
      displaySignupRequests();
    };

    // Reject a user signup
    const rejectSignup = (index) => {
      users.splice(index, 1);
      localStorage.setItem("users", JSON.stringify(users));
      displaySignupRequests();
    };

    // Sign up a new user
    signupBtn.addEventListener("click", () => {
      const username = signupUsername.value.trim();
      const password = signupPassword.value.trim();
      const existingUser = users.find(user => user.username === username);

      if (existingUser) {
        signupError.textContent = "Username already exists!";
      } else {
        const newUser = {
          username,
          password,
          isApproved: false,
        };
        users.push(newUser);
        localStorage.setItem("users", JSON.stringify(users));
        signupError.textContent = "Sign up successful. Awaiting approval from the admin.";
        signupUsername.value = "";
        signupPassword.value = "";
      }
    });

    // Sign in an existing user
    signinBtn.addEventListener("click", () => {
      const username = signinUsername.value.trim();
      const password = signinPassword.value.trim();
      const user = users.find(user => user.username === username && user.password === password && user.isApproved);

      if (user) {
        currentUser = user;
        authSection.classList.add("hidden");
        mainApp.classList.remove("hidden");
      } else {
        signinError.textContent = "Invalid credentials or account not approved by admin.";
      }
    });

    // Admin login
    adminLoginBtn.addEventListener("click", () => {
      if (adminUsername.value === "heyman" && adminPassword.value === "12345678") {
        adminLoggedIn = true;
        adminError.textContent = "";
        checkAdminAccess();
      } else {
        adminError.textContent = "Invalid admin credentials!";
      }
    });

    // Logout functionality
    logoutBtn.addEventListener("click", () => {
      authSection.classList.remove("hidden");
      mainApp.classList.add("hidden");
      adminLoggedIn = false;
      currentUser = null;
    });

    // Initialize the app
    checkAdminAccess();

  </script>
</body>
</html>
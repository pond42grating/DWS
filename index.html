<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Save, Retrieve, and Export Data</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    .input-section {
      margin-bottom: 15px;
    }
    .details-section {
      margin-top: 10px;
      margin-bottom: 20px;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Project Information</h1>

  <!-- Form for basic input -->
  <div class="input-section">
    <label for="structureName">Structure Name:</label>
    <input type="text" id="structureName" placeholder="Enter Structure Name" required><br><br>

    <label for="work">Work:</label>
    <input type="text" id="work" placeholder="Enter Work" required><br><br>

    <label for="location">Location:</label>
    <input type="text" id="location" placeholder="Enter Location" required><br><br>

    <button id="saveData">Save Data</button>
  </div>

  <div class="details-section">
    <h3>Manpower, Equipment, and Materials</h3>
    
    <!-- Buttons to open detailed input for Manpower, Equipment, and Materials -->
    <button id="addManpowerBtn">Add Manpower</button>
    <button id="addEquipmentBtn">Add Equipment</button>
    <button id="addMaterialBtn">Add Material</button>
    
    <!-- Hidden sections for Manpower, Equipment, and Materials -->
    <div id="manpowerSection" class="hidden">
      <h4>Manpower Details</h4>
      <label for="manpowerBadgeNumber">Badge Number:</label>
      <input type="text" id="manpowerBadgeNumber" placeholder="Enter Badge Number"><br><br>

      <label for="manpowerName">Name:</label>
      <input type="text" id="manpowerName" placeholder="Enter Name"><br><br>

      <label for="manpowerJobTitle">Job Title:</label>
      <input type="text" id="manpowerJobTitle" placeholder="Enter Job Title"><br><br>

      <label for="manpowerNormalHours">Normal Hours Worked:</label>
      <input type="number" id="manpowerNormalHours" placeholder="Enter Normal Hours Worked"><br><br>

      <label for="manpowerOvertime">Overtime:</label>
      <input type="number" id="manpowerOvertime" placeholder="Enter Overtime Hours"><br><br>

      <label for="manpowerHoliday">Holiday:</label>
      <input type="number" id="manpowerHoliday" placeholder="Enter Holiday Hours"><br><br>

      <button id="saveManpower">Save Manpower</button>
    </div>

    <div id="equipmentSection" class="hidden">
      <h4>Equipment Details</h4>
      <label for="equipmentName">Name:</label>
      <input type="text" id="equipmentName" placeholder="Enter Equipment Name"><br><br>

      <label for="equipmentQuantity">Quantity:</label>
      <input type="number" id="equipmentQuantity" placeholder="Enter Quantity"><br><br>

      <label for="equipmentHours">Hours Used:</label>
      <input type="number" id="equipmentHours" placeholder="Enter Equipment Hours Used"><br><br>

      <button id="saveEquipment">Save Equipment</button>
    </div>

    <div id="materialsSection" class="hidden">
      <h4>Material Details</h4>
      <label for="materialName">Material Name:</label>
      <input type="text" id="materialName" placeholder="Enter Material Name"><br><br>

      <label for="materialQuantity">Quantity:</label>
      <input type="number" id="materialQuantity" placeholder="Enter Material Quantity"><br><br>

      <button id="saveMaterial">Save Material</button>
    </div>
  </div>

  <h2>Search Users</h2>
  <input type="text" id="searchName" placeholder="Enter Name to Search">
  <button id="searchUser">Search</button>
  <div id="searchResult"></div>

  <h2>Saved Data:</h2>
  <ul id="userList"></ul>

  <button id="exportConsolidated">Export Consolidated Excel</button>

  <script>
    // Load data from localStorage on page load
    const savedData = JSON.parse(localStorage.getItem("projectData")) || [];

    const displayData = () => {
      const userList = document.getElementById("userList");
      userList.innerHTML = ""; // Clear existing list
      savedData.forEach((data, index) => {
        const listItem = document.createElement("li");
        listItem.textContent = `Structure: ${data.StructureName}, Work: ${data.Work}, Location: ${data.Location}`;
        listItem.innerHTML += ` <button onclick="exportData(${index})">Export Data</button>`;
        userList.appendChild(listItem);
      });
    };

    // Save project data (structure, work, location)
    document.getElementById("saveData").addEventListener("click", () => {
      const structureName = document.getElementById("structureName").value.trim();
      const work = document.getElementById("work").value.trim();
      const location = document.getElementById("location").value.trim();

      if (!structureName || !work || !location) {
        alert("Please fill in all fields!");
        return;
      }

      const project = { StructureName: structureName, Work: work, Location: location, Manpower: [], Equipment: [], Materials: [] };

      // Save to the array and localStorage
      savedData.push(project);
      localStorage.setItem("projectData", JSON.stringify(savedData));

      displayData();

      // Clear input fields
      document.getElementById("structureName").value = "";
      document.getElementById("work").value = "";
      document.getElementById("location").value = "";
    });

    // Add Manpower details
    document.getElementById("addManpowerBtn").addEventListener("click", () => {
      document.getElementById("manpowerSection").classList.toggle("hidden");
    });

    // Save Manpower
    document.getElementById("saveManpower").addEventListener("click", () => {
      const badgeNumber = document.getElementById("manpowerBadgeNumber").value.trim();
      const name = document.getElementById("manpowerName").value.trim();
      const jobTitle = document.getElementById("manpowerJobTitle").value.trim();
      const normalHours = document.getElementById("manpowerNormalHours").value.trim();
      const overtime = document.getElementById("manpowerOvertime").value.trim();
      const holiday = document.getElementById("manpowerHoliday").value.trim();

      const manpower = { BadgeNumber: badgeNumber, Name: name, JobTitle: jobTitle, NormalHours: normalHours, Overtime: overtime, Holiday: holiday };

      const lastIndex = savedData.length - 1;
      savedData[lastIndex].Manpower.push(manpower);
      localStorage.setItem("projectData", JSON.stringify(savedData));

      // Clear fields and hide section
      document.getElementById("manpowerBadgeNumber").value = "";
      document.getElementById("manpowerName").value = "";
      document.getElementById("manpowerJobTitle").value = "";
      document.getElementById("manpowerNormalHours").value = "";
      document.getElementById("manpowerOvertime").value = "";
      document.getElementById("manpowerHoliday").value = "";
      document.getElementById("manpowerSection").classList.add("hidden");

      displayData();
    });

    // Add Equipment details
    document.getElementById("addEquipmentBtn").addEventListener("click", () => {
      document.getElementById("equipmentSection").classList.toggle("hidden");
    });

    // Save Equipment
    document.getElementById("saveEquipment").addEventListener("click", () => {
      const equipmentName = document.getElementById("equipmentName").value.trim();
      const quantity = document.getElementById("equipmentQuantity").value.trim();
      const hoursUsed = document.getElementById("equipmentHours").value.trim();

      const equipment = { Name: equipmentName, Quantity: quantity, HoursUsed: hoursUsed };

      const lastIndex = savedData.length - 1;
      savedData[lastIndex].Equipment.push(equipment);
      localStorage.setItem("projectData", JSON.stringify(savedData));

      // Clear fields and hide section
      document.getElementById("equipmentName").value = "";
      document.getElementById("equipmentQuantity").value = "";
      document.getElementById("equipmentHours").value = "";
      document.getElementById("equipmentSection").classList.add("hidden");

      displayData();
    });

    // Add Material details
    document.getElementById("addMaterialBtn").addEventListener("click", () => {
      document.getElementById("materialsSection").classList.toggle("hidden");
    });

    // Save Material
    document.getElementById("saveMaterial").addEventListener("click", () => {
      const materialName = document.getElementById("materialName").value.trim();
      const quantity = document.getElementById("materialQuantity").value.trim();

      const material = { Name: materialName, Quantity:
            const material = { Name: materialName, Quantity: quantity };

      const lastIndex = savedData.length - 1;
      savedData[lastIndex].Materials.push(material);
      localStorage.setItem("projectData", JSON.stringify(savedData));

      // Clear fields and hide section
      document.getElementById("materialName").value = "";
      document.getElementById("materialQuantity").value = "";
      document.getElementById("materialsSection").classList.add("hidden");

      displayData();
    });

    // Search for a user by name
    document.getElementById("searchUser").addEventListener("click", () => {
      const searchName = document.getElementById("searchName").value.trim().toLowerCase();
      const result = savedData.filter(data => data.StructureName.toLowerCase().includes(searchName));
      
      const searchResultDiv = document.getElementById("searchResult");
      searchResultDiv.innerHTML = ""; // Clear previous results

      if (result.length > 0) {
        result.forEach((data) => {
          const div = document.createElement("div");
          div.textContent = `Found: ${data.StructureName} - Work: ${data.Work}`;
          searchResultDiv.appendChild(div);
        });
      } else {
        searchResultDiv.textContent = "No matching records found.";
      }
    });

    // Export data to Excel
    document.getElementById("exportConsolidated").addEventListener("click", () => {
      const ws = XLSX.utils.json_to_sheet(savedData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Project Data");
      XLSX.writeFile(wb, "consolidated_project_data.xlsx");
    });

    // Export individual project data
    function exportData(index) {
      const ws = XLSX.utils.json_to_sheet([savedData[index]]);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Project Data");
      XLSX.writeFile(wb, `${savedData[index].StructureName}_project_data.xlsx`);
    }

    // Initial display of saved data
    displayData();
  </script>
</body>
</html>

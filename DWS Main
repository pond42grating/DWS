<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Save, Retrieve, and Export Data</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <h1>User Information</h1>

  <!-- Form for Input -->
  <label for="name">Name:</label>
  <input type="text" id="name" placeholder="Enter Name" required><br><br>

  <label for="age">Age:</label>
  <input type="number" id="age" placeholder="Enter Age" required><br><br>

  <label for="placeOfBirth">Place of Birth:</label>
  <input type="text" id="placeOfBirth" placeholder="Enter Place of Birth" required><br><br>

  <button id="saveData">Save Data</button>
  <button id="exportConsolidated">Export Consolidated Excel</button>

  <h2>Search Users</h2>
  <input type="text" id="searchName" placeholder="Enter Name to Search">
  <button id="searchUser">Search</button>
  <div id="searchResult"></div>

  <h2>Saved Users:</h2>
  <ul id="userList"></ul>

  <script>
    // Load data from localStorage on page load
    const savedData = JSON.parse(localStorage.getItem("userData")) || [];

    // Function to display saved users
    const displayUsers = () => {
      const userList = document.getElementById("userList");
      userList.innerHTML = ""; // Clear existing list
      savedData.forEach(user => {
        const listItem = document.createElement("li");
        listItem.textContent = `${user.Name} (Age: ${user.Age}, Place of Birth: ${user.PlaceOfBirth})`;
        listItem.innerHTML += ` <button onclick="exportIndividual('${user.Name}')">Export ${user.Name}'s Excel</button>`;
        userList.appendChild(listItem);
      });
    };

    // Save data and update localStorage
    document.getElementById("saveData").addEventListener("click", () => {
      const name = document.getElementById("name").value.trim();
      const age = document.getElementById("age").value.trim();
      const placeOfBirth = document.getElementById("placeOfBirth").value.trim();

      if (!name || !age || !placeOfBirth) {
        alert("Please fill in all fields!");
        return;
      }

      // Add new data to savedData array
      savedData.push({ Name: name, Age: age, PlaceOfBirth: placeOfBirth });

      // Save to localStorage
      localStorage.setItem("userData", JSON.stringify(savedData));

      // Display updated users and clear inputs
      displayUsers();
      document.getElementById("name").value = "";
      document.getElementById("age").value = "";
      document.getElementById("placeOfBirth").value = "";
    });

    // Export individual user's data to Excel
    window.exportIndividual = (name) => {
      const userData = savedData.find(user => user.Name === name);
      if (!userData) {
        alert("User not found!");
        return;
      }

      const workbook = XLSX.utils.book_new();
      const worksheet = XLSX.utils.json_to_sheet([userData]);
      XLSX.utils.book_append_sheet(workbook, worksheet, "Sheet1");
      XLSX.writeFile(workbook, `${name}.xlsx`);
    };

    // Export all data to a consolidated Excel file
    document.getElementById("exportConsolidated").addEventListener("click", () => {
      if (savedData.length === 0) {
        alert("No data to export!");
        return;
      }

      const workbook = XLSX.utils.book_new();
      const worksheet = XLSX.utils.json_to_sheet(savedData);
      XLSX.utils.book_append_sheet(workbook, worksheet, "All Users");
      XLSX.writeFile(workbook, "Consolidated_Data.xlsx");
    });

    // Search for a user by name
    document.getElementById("searchUser").addEventListener("click", () => {
      const searchName = document.getElementById("searchName").value.trim().toLowerCase();
      const result = savedData.filter(user => user.Name.toLowerCase() === searchName);

      const searchResult = document.getElementById("searchResult");
      if (result.length > 0) {
        searchResult.innerHTML = `<strong>Found:</strong> ${result[0].Name} (Age: ${result[0].Age}, Place of Birth: ${result[0].PlaceOfBirth})`;
      } else {
        searchResult.textContent = "No user found with that name.";
      }
    });

    // Display users on page load
    displayUsers();
  </script>
</body>
</html>
